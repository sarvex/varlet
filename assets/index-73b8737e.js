import{i as L,c as v}from"./elements-b6d7a45c.js";import{ax as k,aG as d}from"./vue-router.esm-bundler-0d52b99f.js";import{c as w}from"./shared-ed2007b2.js";import{b as I}from"./components-02edd959.js";const b="background-image",O="lazy-loading",R="lazy-error",f="lazy-attempt",W=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],u="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",n=[],c=[],y=w(100),e={loading:u,error:u,attempt:3,throttleWait:300,events:W};let A=d(o,e.throttleWait);function s(t,a){t._lazy.arg===b?t.style.backgroundImage=`url(${a})`:t.setAttribute("src",a)}function G(t){t._lazy.loading&&s(t,t._lazy.loading),o()}function C(t){t._lazy.error&&s(t,t._lazy.error),t._lazy.state="error",m(t),o()}function p(t,a){s(t,a),t._lazy.state="success",m(t),o()}function N(t){var a;c.includes(t)||(c.push(t),(a=e.events)==null||a.forEach(r=>{t.addEventListener(r,A,{passive:!0})}))}function B(){c.forEach(t=>{var a;(a=e.events)==null||a.forEach(r=>{t.removeEventListener(r,A)})}),c.length=0}function P(t,a){const r={loading:t.getAttribute(O)??e.loading,error:t.getAttribute(R)??e.error,attempt:t.getAttribute(f)?Number(t.getAttribute(f)):e.attempt};t._lazy={src:a.value,arg:a.arg,currentAttempt:0,state:"pending",attemptLock:!1,...r},s(t,u),I(e.filter,t._lazy)}function T(t,a){const r=new Image;r.src=a,t._lazy.preloadImage=r,r.addEventListener("load",()=>{t._lazy.attemptLock=!1,y.add(a),p(t,a)}),r.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?C(t):z(t)})}function z(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:a}=t._lazy;if(y.has(a)){p(t,a),t._lazy.attemptLock=!1;return}G(t),T(t,a)}async function l(t){await L(t)&&z(t)}function o(){n.forEach(t=>l(t))}async function D(t){!n.includes(t)&&n.push(t),v(t).forEach(N),await l(t)}function m(t){k(n,t),n.length===0&&B()}function M(t,a){const{src:r,arg:i}=t._lazy;return r!==a.value||i!==a.arg}async function g(t,a){P(t,a),await D(t)}async function S(t,a){if(!M(t,a)){n.includes(t)&&await l(t);return}await g(t,a)}function Y(t={}){const{events:a,loading:r,error:i,attempt:h,throttleWait:_,filter:E}=t;e.events=a??e.events,e.loading=r??e.loading,e.error=i??e.error,e.attempt=h??e.attempt,e.throttleWait=_??e.throttleWait,e.filter=E}const Z={mounted:g,unmounted:m,updated:S,install(t,a){Y(a),A=d(o,e.throttleWait),t.directive("lazy",this)}},Q=Z;export{Q as v};
